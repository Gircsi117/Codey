<%- include("../header") %>
<h1 style="color: red; text-align: center;" class="error">Az oldal nem támogatja ezt a képernyő szélességet</h1>
    <div class="container mt-0 mt-sm-3">

        <%- include("../menu") %>
        <div class="content row m-0 p-0">
            <div class="gray">
                <div id="chartContainerFS" style="height: 370px; width: 100%; padding: 0; margin: 0;"></div>
            </div>
            <div class="gray">
                <div id="chartContainerWater" style="height: 370px; width: 100%; padding: 0; margin: 0;"></div>
            </div>
            <div class="gray">
                <div id="chartContainerWeight" style="height: 370px; width: 100%; padding: 0; margin: 0;"></div>
            </div>
        </div>
        
        <%- include("../foot") %>
    </div>

<script>
    $.ajax({method:"POST", url:"/", data:{
        drinkToday:0,
        useToday:0,
        eatenToday:0
    }})
    .done((res)=>{
        console.log(res);
        let food = [];
        let sport = [];
        let water = [];

        for (let i = 0; i < res.foods.length; i++) {
            let kcal = 0
            res.foods[i].kcal.forEach(item => {
                kcal += item.kcal * item.multiplier
            });

            let item = {x: new Date(res.foods[i].date), y: kcal}

            if (food.length > 0 && food[food.length-1].x.getTime() == item.x.getTime()) {
                console.log("-");
                food[food.length-1].y += kcal;
            }
            else{
                food.push(item);
            }
        }

        res.sports.forEach(element => {
            sport.push({ x: new Date(element.datum), y: element.mennyiseg });
        });

        res.waters.forEach(element => {
            water.push({ x: new Date(element.datum), y: element.mennyiseg });
        }); 

        createGraphs({
            id:"chartContainerFS",
            mainTitle: 'Étkezés / Testmozgás',
            yTitle: "Kcal",
            results:[
                {
                    name: 'Étkezés',
                    datas: food,
                    color:"red"
                },
                {
                    name: 'Sport',
                    datas: sport,
                    color:"green"
                },
            ]
        })

        createGraphs({
            id:"chartContainerWater",
            mainTitle: 'Folyadék bevitel',
            yTitle: "dl",
            results:[
                {
                    name: 'Folyadék',
                    datas: water,
                    color:"blue"
                },
            ]
        })

    })
    .fail((err)=>{
        console.log(err);
    })
    .always(()=>{})

    $.ajax({method:"GET", url:"./getWeights"})
    .done((res)=>{
        let weight = [];
        //console.log(res.data.allWeights);
        let weightData = res.data.allWeights

        for (let i = 0; i < weightData.length; i++) {
            let item = { x: new Date(weightData[i].datum), y: weightData[i].suly }
            
            if (weight.length > 0 && weight[weight.length-1].x.getTime() == item.x.getTime()) {
                weight[weight.length-1].y += kcal;
            }
            else{
                weight.push(item);
            }
        }

        createGraphs({
            id:"chartContainerWeight",
            mainTitle: 'Súly alakulás',
            yTitle: "Kg",
            results:[
                {
                    name: 'Súly',
                    datas: weight,
                    color:"black"
                },
            ]
        })
    })
    .fail((err)=>{
        console.log(err);
    })
    .always(()=>{ })
</script>

<%- include("../footer") %>


