<%- include("../header") %>
<h1 style="color: red; text-align: center" class="error">Az oldal nem támogatja ezt a képernyő szélességet</h1>
<div class="container mt-0 mt-sm-3">
    <%- include("../menu") %>

    <div class="content row m-0 p-3">
        <div id="tabs" class="content">
            <ul class="content border-0">
                <li class="btn btn-primary"><a href="#all-blogs">Összes blog</a></li>
                <li class="btn btn-primary"><a href="#user-blogs">Saját blogok</a></li>
            </ul>
            <div class="container" id="all-blogs"></div>
            <div class="container" id="user-blogs">
                <div class="gray">
                    <div class="row">
                        <div class="col-6">
                            <button type="button" class="btn btn-success" id="newBlog" onclick="openModal()">Hozzáadás</button>
                        </div>
                    </div>
                </div>
            </div>

            <div id="blogModal">
                <div class="col-12 col-md-8 p-0 h-50">
                    <h1 id="cim"></h1>
                </div>
                <div class="form-floating p-2">
                    <input type="text" class="form-control" id="title" placeholder="" />
                    <label for="title">Cím:</label>
                </div>
                <div class="form-floating p-2">
                    <textarea type="text" class="form-control" style="min-height: 400px" id="blog" placeholder="asd"></textarea>
                    <label for="blog">Tartalom:</label>
                </div>
            </div>
        </div>

        <%- include("../foot") %>
    </div>

    <script>
        function openModal() {
            $('#blogModal').removeClass('d-none');
        }

        //tabs
        $('#tabs')
            .tabs()
            .ready(() => {
                setModal('blogModal', {
                    cim: 'Saját blog',
                    buttons: [
                        { type: 'success', text: 'Létrehozás', id: 'create' },
                        { type: 'secondary', text: 'Vissza', id: 'back' },
                    ],
                });

                //vissza
                $('#blogModal #back').on('click', () => {
                    $('#blogModal').addClass('d-none');
                });

                //mentés
                $('#blogModal #create').on('click', () => {
                    $.ajax({
                        method: 'post',
                        url: './postBlog',
                        data: {
                            cim: $('#blogModal #title').val(),
                            tartalom: $('#blogModal #blog').val(),
                        },
                    })
                        .done((res) => {
                            if (!res.data.success) return notify(res.data.err);
                            notify('Blog létrehozva, megerősítésre vár', 'green');
                        })
                        .fail((err) => {
                            console.log(err);
                        })
                        .always(() => {});
                    $('#blogModal').addClass('d-none');
                });
            });

        //összes blog
        $.ajax({ method: 'get', url: './getAllActiveBlog' })
            .done((data) => {
                let str = '';

                data.data.blogs.forEach((element) => {
                    str += `<div class="mt-3 col-12 col-lg-8 m-auto">
            <div class="m-1 p-4 gray blog-container">
                <h2 class="d-block p-0 cim">${element.cim}</h2>
                <h6 class="keszito">Készítette: ${element.felhasznalo}</h6>
                <hr />
                <div class="blog-content">
                    <p>${element.tartalom}</p>
                </div>
                <h6 class="col-12 text-end datum">${moment(element.idopont).format('YYYY-MM-DD, hh:mm')}</h6>
            </div>
            </div>`;
                });

                $('#all-blogs').html(str);
            })
            .fail((err) => {
                notify('Adatbázis hiba');
                console.log(err);
            })
            .always(() => {});

        //felhasználó blogjai
        $.ajax({ method: 'get', url: './getBlogByUser' })
            .done((data) => {
                let str = $('#user-blogs').html();

                data.data.blogs.forEach((element) => {
                    if (element.status == 1) {
                        style = 'btn btn-success';
                        state = 'Aktív';
                    } else {
                        style = 'btn btn-danger';
                        state = 'Inaktív';
                    }

                    str += `<div class="mt-3 col-12 col-lg-8 m-auto">
            <div class="m-1 p-4 gray blog-container">
                <div style="width: 100px" class="float-end ${style}">${state}</div>
                <h2 class="d-block p-0 cim">${element.cim}</h2>
                <h6 class="keszito">Készítette: ${element.felhasznalo}</h6>
                <hr />
                <div class="blog-content">
                    <p>${element.tartalom}</p>
                </div>
                <h6 class="col-12 text-end datum">${moment(element.idopont).format('YYYY-MM-D, hh:mm')}</h6>
            </div>
            </div>`;
                });

                $('#user-blogs').html(str);
            })
            .fail((err) => {
                notify('Adatbázis hiba');
                console.log(err);
            })
            .always(() => {});
    </script>

    <%- include("../footer") %>
</div>

<!-- <div class="gray">
    <div class="row">
        <div class="col-6">
            <button type="button" class="btn btn-success" id="newBlog" onclick="openModal()">Hozzáadás</button>
        </div>

        <div class="col-6">
            <input class="form-control" id="search-bar" type="text" placeholder="Keresés..." />

            <div class="m-1 p-1 row">
                <div class="col-3">
                    <input class="form-check-input" type="checkbox" name="search-title" value="" />
                    <label class="form-check-label" for="search-title">Cím</label>
                </div>
                <div class="col-3">
                    <input class="form-check-input" type="checkbox" name="search-search" value="" />
                    <label class="form-check-label" for="search-search">Készítő</label>
                </div>
                <div class="col-6">
                    <input class="mt-0" type="date" name="search-date" value="" />
                    <label class="form-check-label" for="search-date">Dátum</label>
                </div>
            </div>
        </div>
    </div>
</div> -->
